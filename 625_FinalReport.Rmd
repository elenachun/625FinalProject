---
title: "Analyzing the Factors Affecting BMI Percentiles and the Log Odds of Obesity of Children Aged 2-15"
author: "Aanya Mohan, Elena Chun, Siwei Cao"
date: "2023-12-10"
output:
  pdf_document: default
  word_document: default
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction:

Childhood obesity, also known as pediatric obesity, is a pressing issue
that affects youth throughout the country. According to the Center for
Disease Control (CDC), as of 2022, childhood obesity affects 1 in 5
children in the United States.1 There are a variety of factors that can
lead to childhood obesity, from lifestyle to medication or genetic
factors. Studies show that there may be a correlation between birth
weight and the likelihood of childhood obesity. Despite sex differences,
a higher birth weight increases the chances of developing obesity in
adolescents. The National Health and Nutrition Examination Survey
(NHANES) is "designed to address the health and nutritional status of
adults and children in the United States". This survey evaluates all
aspects of a person's health and nutritional habits. Factors recorded
such as gender, age, food security, days physically active, mother
smoked while pregnant, and number of meals from a fast food or pizza
place, can be used to perform a regression analysis. This analysis may
provide an explanation for childhood obesity trends, defined by birth
weight.

## Data Overview:

Data for this analysis comes from the National Health and Nutrition
Examination Survey (NHANES) conducted by the CDC for 2017-2020. The
response variable for this analysis is BMI percentile and the predictor
of interest is weight at birth, measured in pounds, reported for
children ages 2-15 at the time of survey. Other predictor variables
include: gender, days physically active out of the week, whether mother
smoked while pregnant, household food security, race, and number of
meals from a fast food or pizza place in a week. These are all factors
that are believed to explain trends in weight, and its effect on
childhood obesity. Gender and race are demographic information reported
by the survey participants. Days physically active is a metric measuring
how many days of the week youths aged 2-15 are physically active for at
least 60 minutes. Whether mother smoked while pregnant is a binary
variable that assesses the smoking habits of the participants'
biological mother. Food security is a categorical variable which rates
the household food security on a scale of 1 to 4, where 1 is full food
security and 4 is very low food security. Number of meals from a fast
food or pizza place is the estimated number of meals not prepared at
home, from a fast food restaurant or a pizza place, in a week.

## Data Cleaning:

Initially, we wanted to use BMI as the response variable for this
analysis as BMI is commonly used as an indicator of obesity. However
upon further research, we discovered that BMI percentile would be more
appropriate as children are usually measured in percentiles and a
healthy BMI can change depending on what age children are in
development. To create the BMI percentile variable, we used equations
provided by the CDC along with the variables BMI, age, and gender which
were included in the dataset. The birth weight variable in the dataset
was given as two variables of birth weight in pounds (lb) and birth
weight in ounces (oz), which is typically how birth weight is measured
for babies. For easier interpretability, both variables were combined
and reported solely as birth weight in pounds (lb). Below is a table
with summary statistics from the dataset after data cleaning.

```{r, echo=FALSE,message=FALSE,fig.height=3,fig.width=3,fig}
library(haven)
library(tidyverse)
library(dplyr)
library(car)
library(gtsummary)
data <- readRDS('clean_data.RDS')
data$race <- factor(data$race, levels = c(3, 1,2,4,5,6,7))
data$activity1 <- as.character(data$activity)

# Categorize activity into levels
data <- data %>%
  mutate(activity1 = case_when(
    activity1 =='0' ~ "0",
    activity1 =='1' ~ "1-3",
    activity1 =='2' ~ "1-3",
    activity1 =='3' ~ "1-3",
    activity1 =='4' ~ "4-6",
    activity1 =='5' ~ "4-6",
    activity1 =='6' ~ "4-6",
    activity1 =='7' ~ "7",
  ))

data$activity1 <- as.factor(data$activity1)

set_gtsummary_theme(theme_gtsummary_compact())

data%>%select(smoke,sex,age,food_sec,activity,fastfood,race,birthweight,growth_percentile)%>%
  tbl_summary(
    label = list(
      smoke ~ "Mother Smoked When Pregnant",
      sex ~ "Sex",
      food_sec ~ "Food Security",
      activity ~ "Days Physically Active in a Week",
      race ~ "Race",
      fastfood ~ "Number of meals from fast food in a week",
      birthweight ~ "Birth Weight (lbs)",
      growth_percentile ~ "BMI Percentile"),
    missing = "ifany",
    missing_text = "Missing")


```

## Exploratory Analysis:

Previous literature indicated that there would be a positive correlation
between BMI percentile and birth weight. When plotting the entire data,
it is unclear from this initial plot (Figure 1) whether there is a
relationship or not.

```{r, include=FALSE}
#Code for scatterplot of all data
```

After taking a random sample of 50 observations, we can see a slight
positive correlation between birth weight and BMI percentile.

```{r, include=FALSE}
#Code for random sample scatterplot
```

## Model:

The exploratory analysis of this data resulted in the following initial
linear model:
$$BMI Percentile = \beta_{0} + \beta_{1}Sex + \beta_{2}Race + \beta_{3}BirthWeight + \beta_{4}Smoke + \beta_{5}FoodSecurity + \beta_{6}FastFood + \beta_{7}Activity + \varepsilon$$
After fitting this model, we were interested in whether the relationship
between BMI percentile and a predictor depends on levels of another
predictor. To find these interactions, we plotted boxplots of these
relationships. For example, this boxplot of food security against BMI
percentile filled in by sex shows that the association between BMI
percentile and food security is not constant across males and females.

```{r, fig.width=3, fig.height=2}
ggplot(data, aes(x=food_sec, y=growth_percentile, fill=sex)) + 
    geom_boxplot()
```

```{r, include=FALSE}
m2 <- lm(growth_percentile ~ sex+race+birthweight+smoke+food_sec+fastfood+activity1+sex*food_sec, data=data)
summary(m2)
plot(m2, which=2)
```

Thus, we included the interaction between food security and sex into our
regression model:\
$Growth Percentile = \beta_{0} + \beta_{1}Sex + \beta_{2}Race + \beta_{3}BirthWeight + \beta_{4}Smoke + \beta_{5}FoodSecurity + \beta_{6}FastFood$\
$+ \beta_{7}Activity + \beta_{8}Sex*FoodSecurity +\varepsilon$\

However, the resulting normal qq plot deviated from a linear line,
meaning the normality assumption of residuals was not fulfilled. Thus,
we added in a square root transformation to the BMI percentile response
variable. Thus the resulting linear regression model is:\
$sqrt(Growth Percentile) = \beta_{0} + \beta_{1}Sex + \beta_{2}Race + \beta_{3}BirthWeight + \beta_{4}Smoke + \beta_{5}FoodSecurity$\
$+\beta_{6}FastFood + \beta_{7}Activity + \beta_{8}Sex*FoodSecurity +\varepsilon$\

This linear regression model allows us to identify the factors
associated with BMI percentiles of children. However, we would also like
to examine factors associated with child obesity. The CDC identifies BMI
percentiles at or above the 95th percentile as obese, so we accordingly
transformed our BMI percentile response variable to a binary variables
(0: not obese, 1: obese). We fit a logistic regression model of this
obesity binary variable to the predictors we identified in our linear
regression model:\
$$P(obesity = 1) = \frac{1}{1 + e^{-(\beta_0 + \beta_1Sex + \beta_2Race + \beta_3BirthWeight + \beta_4Smoke + \beta_5FoodSecurity + \beta_6FastFood + \beta_7Activity)}} $$

```{r, include=FALSE}
#Logistic regression for obese binary variable
data <- data %>%
  mutate(obese = case_when(
    growth_percentile < 95 ~ 0,
    growth_percentile >= 95 ~ 1
  ))

data$gobese <- as.factor(data$obese)
data

m4 <- glm(obese ~ sex+race+birthweight+smoke+food_sec+fastfood+activity1, data = data, family = binomial)
summary(m4)
AIC(m4)
```

## Diagnostics:

```{r, fig.width=6, fig.height=3}
m3 <- lm(sqrt(growth_percentile) ~ sex+race+birthweight+smoke+food_sec+fastfood+activity1+sex*food_sec, data=data)
par(mfrow = c(1, 3))
plot(m3, which=c(1,2,3))
```

First, we will examine diagnostics of the linear regression model. The
residuals vs fitted values plot has a random scatter, indicating that
the linearity assumption is held. The normal qq plot follows the linear
line relatively well, showing that the residuals are approximately
normally distributed. The scale-location plot has relatively equally
spread points across the line, suggesting that the assumption of
constant variance is reasonable. This shows that the linear regression
model is a good fit for the data.

```{r, fig.width=5, fig.height=3}
cooks_distance <- cooks.distance(m4)
plot(cooks_distance, pch = 20, main = "Cook's Distance Plot")

vif(m4)
```

Next we will examine diagnostics of the logistic regression model. The
cook's distance plot ranges from 0 to 0.004, showing that there are few
to no potential outliers. There are no clusters of high cooks'
distances, meaning that are no groups of observations that have strong
influence on the model. Additionally, the variance inflation factor
(VIF) values are close to one, meaning that there is low
multicollinearity in the regression analysis.

## Results:

Based on our linear regression analysis, significant associations with
BMI percentile include birth weight, whether mother smoked during
pregnancy, seven days of physical activity, being Mexican American,
being Other Hispanic, being Asian, and being female with very low food
security. For every 1 pound increase in birth weight, BMI percentile
increases about 3 percentiles adjusting for all other variables.
Children with 7 days of physical activity have BMI percentiles about 14
percentiles lower compared to children with 0 days of physical activity
adjusting for all other variables. Additionally, the effect of very low
food security on BMI percentile is different for females and males.
Asian children have BMI percentiles about 11 percentiles lower compared
to White children adjusting for all other variables.

Based on our logistic regression analysis, the odds of being obese for
white Americans is about 1.49 times higher than Mexican Americans and
0.566 times the odds for Asians. The odds of obesity for children with
mothers who smoked during pregnancy are about 0.664 times the odds of
those without. The odds of obesity for children with physical activity 7
days a week are about 0.360 times the odds of those that do not have any
physically active days a week. The odds of obesity increase by about 19%
for a one pound increase in birth weight, and increase by about 5.8% for
a one meal increase in fast food per week.

## Conclusions:

Using linear regression, we identified factors associated with BMI
percentiles in children of ages 2-15. There are both innate and
environmental factors that are associated with BMI percentiles. As
childhood obesity is a serious problem that is often overlooked, it is
important to further study these factors and promote a healthier
lifestyle among children In the future, we would like to replicate our
analysis after imputing data for number of fast food meals/week using
MICE (Multiple Imputation by Chained Equation).\

Link to GitHub repository:
<https://github.com/elenachun/625FinalProject>
